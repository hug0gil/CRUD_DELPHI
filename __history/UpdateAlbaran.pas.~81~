unit UpdateAlbaran;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants,
  System.Classes,
  Vcl.Graphics, Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.StdCtrls,
  Vcl.ComCtrls,
  FireDAC.Comp.Client, FireDAC.Stan.Intf, FireDAC.Stan.Option,
  FireDAC.Stan.Error,
  FireDAC.UI.Intf, FireDAC.Phys.Intf, FireDAC.Stan.Def, FireDAC.Stan.Pool,
  FireDAC.Stan.Async, FireDAC.Phys, FireDAC.Phys.FB, FireDAC.Phys.FBDef,
  FireDAC.VCLUI.Wait, Data.DB, FireDAC.Stan.Param, FireDAC.DatS,
  FireDAC.DApt.Intf, FireDAC.DApt, FireDAC.Comp.DataSet,MenuAlbaran;

type
  TFormUpdateAlbaran = class(TForm)
    ButtonAdd: TButton;
    ButtonCancelar: TButton;
    ComboBoxCliente: TComboBox;
    FechaDate: TDateTimePicker;
    LabelCliente: TLabel;
    LabelCodigo: TLabel;
    LabelFecha: TLabel;
    LabelObservaciones: TLabel;
    MemoObservaciones: TMemo;
    Connection: TFDConnection;
    EditCodigo: TEdit;

    procedure ButtonCancelarClick(Sender: TObject);
    procedure ButtonAddClick(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
    CodigoAlbaran: Integer;
  end;

var
  FormUpdateAlbaran: TFormUpdateAlbaran;
  QueryActualizar: TFDQuery;

implementation

{$R *.dfm}

procedure TFormUpdateAlbaran.ButtonAddClick(Sender: TObject);

begin

  QueryActualizar := TFDQuery.Create(nil);

  QueryActualizar.Connection := Connection;

  QueryActualizar.SQL.Text :=
    'UPDATE ALBARAN SET DFECHA=:Fecha, COBSERVACIONES=:Observaciones, NCOD_CLIENTE=:Cod_Cliente WHERE NCODIGO=:Cod;';

  QueryActualizar.ParamByName('Fecha').AsDate := FechaDate.Date;
  QueryActualizar.ParamByName('Observaciones').AsString :=
    MemoObservaciones.Text;
  QueryActualizar.ParamByName('Cod_Cliente').AsInteger :=
    StrToInt(ComboBoxCliente.Items[ComboBoxCliente.ItemIndex]);
  QueryActualizar.ParamByName('Cod').AsInteger := CodigoAlbaran;
  QueryActualizar.ExecSQL;

  ShowMessage('Albarán actualizado correctamente.');

  QueryActualizar.Free;


  FormAlbaran.FDQuerySelec.Refresh;
  Self.Close;
end;

procedure TFormUpdateAlbaran.ButtonCancelarClick(Sender: TObject);
begin
  Self.Close;
end;

end.
